import{J as f,k as y,L as E}from"./mftsccs-browser-D_uubYVV.js";import{P as v,g as L,C as o,J as P,K as S}from"./index-CfahUM3g.js";import"./codemirror-D1H9tReK.js";import"./vendor-DEYWGvhS.js";import"./ckeditor-Cw9bcqxY.js";import"./eslint4b-BLWGvIOa.js";import"./prettier-ClL2wQep.js";function u(e){e?.library?.css?.length&&_(e),e?.library?.js?.length&&w(e)}function _(e){const t=e?.library?.css,r=`vde-css-${e?.origin?e?.origin:e?.widgetId}`;A(r),t?.length&&t?.sort((s,i)=>Number(s?.order)-Number(i?.order)),t?.forEach(s=>{const i=document.createElement("link");i.classList.add(r),i.setAttribute("rel","stylesheet"),i.setAttribute("href",s.url),document.head.appendChild(i)})}function w(e){const t=e?.library?.js,r=`vde-js-${e?.origin?e?.origin:e?.widgetId}`;C(r),t?.length&&t?.sort((s,i)=>Number(s?.order)-Number(i?.order)),t?.forEach(s=>{const i=document.createElement("script");i.classList.add(r),i.setAttribute("type","text/javascript"),i.setAttribute("src",s.url),document.body.appendChild(i)})}function A(e){const t=`link.${e}`,r=document.querySelectorAll(t);r?.length&&r?.forEach(s=>{s.remove()})}function C(e){const t=`script.${e}`,r=document.querySelectorAll(t);r?.length&&r?.forEach(s=>{s.remove()})}class J extends f{page_id;_pageTsccsService;_attributesService;constructor(t){super(),this.setTitle("Page Builder"),this.page_id=Number(t.id),this._pageTsccsService=new v,this.init()}before_render(){}async init(){const t=await L(),r=await this._pageTsccsService.isPageTemplate(this.page_id);!t?.token&&!t?.token&&!r&&(window.location.href="/");const s=t?.token||"",i=await this._pageTsccsService.getPageById(this.page_id),g=i?.data?.[`the_${o.PAGE_COMP_NAME}`]?.[`the_${o.PAGE_COMP_NAME}_body`];await P(i?.data?.[`the_${o.PAGE_COMP_NAME}`]);const c=document.getElementById("app");c.classList.add("fspage");let l=parseInt(g?.id),h=await S(l,s),a=await y(h?.widgetId??l);const b=await E(a,c);u(a),a?.children?.length&&a?.children?.forEach(n=>{const m=n?.library;(m?.css?.length||m?.js?.length)&&u(n)}),c.querySelectorAll(".wb-initial-empty").forEach(n=>{n.classList.remove("wb-initial-empty")}),document.querySelectorAll('[onclick="widgetSelected(event)"]').forEach(n=>{n.removeAttribute("onclick")});const d=document.createElement("style");d.innerHTML=a.css+b.css,c.appendChild(d);const p=document.createElement("script");p.innerHTML=a.js,c.appendChild(p)}getHtml(){return'<div id="fspage-preview"></div>'}}export{J as default};
