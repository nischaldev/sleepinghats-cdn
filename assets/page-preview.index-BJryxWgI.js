import{q as b,n as f,J as y}from"./mftsccs-browser-Cj5m6_BU.js";import{P as E,g as v,C as c,I as L,J as S}from"./index-q0xBaVea.js";import"./codemirror-D1H9tReK.js";import"./vendor-DEYWGvhS.js";import"./ckeditor-Cw9bcqxY.js";import"./eslint4b-BLWGvIOa.js";import"./prettier-ClL2wQep.js";function m(e){e?.library?.css?.length&&P(e),e?.library?.js?.length&&_(e)}function P(e){const t=e?.library?.css,s=`vde-css-${e?.origin?e?.origin:e?.widgetId}`;A(s),t?.length&&t?.sort((i,r)=>Number(i?.order)-Number(r?.order)),t?.forEach(i=>{const r=document.createElement("link");r.classList.add(s),r.setAttribute("rel","stylesheet"),r.setAttribute("href",i.url),document.head.appendChild(r)})}function _(e){const t=e?.library?.js,s=`vde-js-${e?.origin?e?.origin:e?.widgetId}`;I(s),t?.length&&t?.sort((i,r)=>Number(i?.order)-Number(r?.order)),t?.forEach(i=>{const r=document.createElement("script");r.classList.add(s),r.setAttribute("type","text/javascript"),r.setAttribute("src",i.url),document.body.appendChild(r)})}function A(e){const t=`link.${e}`,s=document.querySelectorAll(t);s?.length&&s?.forEach(i=>{i.remove()})}function I(e){const t=`script.${e}`,s=document.querySelectorAll(t);s?.length&&s?.forEach(i=>{i.remove()})}class $ extends b{page_id;_pageTsccsService;_attributesService;constructor(t){super(),this.setTitle("Page Builder"),this.page_id=Number(t.id),this._pageTsccsService=new E,this.init()}before_render(){}async init(){const t=await v();t?.token||(window.location.href="/login");const s=t?.token,i=await this._pageTsccsService.getPageById(this.page_id),r=i?.data?.[`the_${c.PAGE_COMP_NAME}`]?.[`the_${c.PAGE_COMP_NAME}_body`];await L(i?.data?.[`the_${c.PAGE_COMP_NAME}`]);const o=document.getElementById("app");o.classList.add("fspage");let l=parseInt(r?.id),g=await S(l,s),a=await f(g?.widgetId??l);const h=await y(a,o);m(a),a?.children?.length&&a?.children?.forEach(n=>{const p=n?.library;(p?.css?.length||p?.js?.length)&&m(n)}),o.querySelectorAll(".wb-initial-empty").forEach(n=>{n.classList.remove("wb-initial-empty")}),document.querySelectorAll('[onclick="widgetSelected(event)"]').forEach(n=>{n.removeAttribute("onclick")});const d=document.createElement("style");d.innerHTML=a.css+h.css,o.appendChild(d);const u=document.createElement("script");u.innerHTML=a.js,o.appendChild(u)}getHtml(){return'<div id="fspage-preview"></div>'}}export{$ as default};
